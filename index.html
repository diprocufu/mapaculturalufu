<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mapa Cultural UFU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ADICIONADO -->
  <link rel="stylesheet" href="style-v2.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- √çcones do site -->
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="favicon.png">
  <link rel="shortcut icon" href="favicon.png" type="image/png"> <!-- ‚úÖ Dica extra opcional -->
</head>
<body>
  <header>
    <h1>Mapa Cultural UFU</h1>
  </header>
  <main>
    <div id="map">
    <button id="btn-localizacao">üìç Mostrar minha localiza√ß√£o</button>
    </div>
    <aside>
      <h2>Espa√ßos Culturais</h2>
      <!-- Container para espa√ßos da cidade -->
      <div id="espacos-cidade"></div>

     <!-- Dropdown UFU -->
    <div class="dropdown ufubtn">
      <button class="dropdown-btn">üéì Espa√ßos UFU</button>
      <div class="dropdown-content" id="espacos-ufu"></div>
    </div>

    <!-- Dropdown P√∫blicos -->
      <div class="dropdown publicobtn">
      <button class="dropdown-btn" onclick="carregarCidade('P√∫blico')">üèõÔ∏è Espa√ßos P√∫blicos</button>
      <div class="dropdown-content" id="espacos-publicos"></div>
    </div>

    <!-- Dropdown Privados -->
    <div class="dropdown privadobtn">
      <button class="dropdown-btn" onclick="carregarCidade('Privado')">üé≠ Espa√ßos Privados</button>
      <div class="dropdown-content" id="espacos-privados"></div>
    </div>

    <!-- Dropdown Ponto de Cultura -->
    <div class="dropdown pontobtn">
      <button class="dropdown-btn" onclick="carregarCidade('Ponto de Cultura')">üå± Pontos de Cultura</button>
      <div class="dropdown-content" id="espacos-ponto"></div>
    </div>
    </aside>
  </main>

  <footer>
  ¬© 2025 UFU ‚Äî Desenvolvido por Dr. Andr√© C. Machado ‚Äî   <strong>DIPROC / DICULT / PROEXC - UFU</strong> por meio de IA - 
  <span class="sobre-icone" onclick="mostrarSobre()">‚ÑπÔ∏è</span>
  </footer>


  <script>
    // ===== MAPA E CAMADAS BASE =====
    const map = L.map('map').setView([-18.9186, -48.255], 15);
function calcularDistancia(lat1, lon1, lat2, lon2) {
  const R = 6371; // raio da Terra em km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c; // dist√¢ncia em km
}

    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
      maxZoom: 22
    });

    const cartoLight = L.tileLayer('https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> &copy; <a href="https://carto.com/">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 22
    });

    const esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles ¬© Esri',
      maxZoom: 19
    });

    // Padr√£o: OSM
    osm.addTo(map);

    const baseMaps = {
      "OSM Padr√£o (Padr√£o)": osm,
      "Carto Light": cartoLight,
      "Esri Sat√©lite": esriSat
    };

    L.control.layers(baseMaps).addTo(map);

    // ===== FUN√á√ÉO: √çcone Font Awesome por tipo =====
    function faFor(tipo) {
      const t = (tipo || '').toLowerCase();
      if (t.includes('administr')) return 'building-columns';
      if (t.includes('centro')) return 'building';
      if (t.includes('cinema')) return 'film';
      if (t.includes('curso')) return 'graduation-cap';
      if (t.includes('galeria')) return 'image';
      if (t.includes('museu')) return 'landmark';
      if (t.includes('m√∫sica') || t.includes('musica')) return 'music';
      if (t.includes('pra√ßa') || t.includes('praca')) return 'tree';
      if (t.includes('teatro')) return 'masks-theater';
      return 'map-pin';
    }

const todosOsMarcadores = [];

    // ===== CARREGA ESPA√áOS =====
    fetch('espacos.json?nocache=' + new Date().getTime())
      .then(response => response.json())
      .then(data => {
        const ordemCampiUFU = [
          "Santa M√¥nica",
          "Umuarama",
          "Educa√ß√£o F√≠sica",
          "Gl√≥ria",
          "Ituiutaba",
          "Monte Carmelo",
          "Patos de Minas",
          "Distribu√≠dos por Uberl√¢ndia"
        ];

        data.espacos
          .filter(e => e.tipo !== "separador")
          .sort((a, b) => {
          const ca = ordemCampiUFU.indexOf(a.campus || "");
          const cb = ordemCampiUFU.indexOf(b.campus || "");
          return (ca === -1 ? 999 : ca) - (cb === -1 ? 999 : cb);
          })
          .forEach(espaco => {
        if (espaco.tipo === 'separador') return;
          
          // Marcador no mapa
          const icon = (espaco.categoria && espaco.categoria.toLowerCase() === "ufu")
            ? blueIcon
            : greenIcon;

          const marker = L.marker([espaco.latitude, espaco.longitude], { icon }).addTo(map);
          todosOsMarcadores.push({ marker, espaco });
          const telefone = espaco.telefone ? `<br><b>Tel.:</b> ${espaco.telefone}` : '';
          const site = espaco.site ? `<br><a href="${espaco.site}" target="_blank">Site oficial</a>` : '';
          const email = espaco.email ? `<br><b>Email:</b> <a href="mailto:${espaco.email}">${espaco.email}</a>` : '';

        let distanciaTexto = '';
        if (userMarker) {
          const userLat = userMarker.getLatLng().lat;
          const userLng = userMarker.getLatLng().lng;
          const dist = calcularDistancia(userLat, userLng, espaco.latitude, espaco.longitude);
          distanciaTexto = `<br><b>Dist√¢ncia aproximada:</b> ${dist.toFixed(2)} km`;
}

marker.bindPopup(
  `<b>${espaco.nome}</b><br>${espaco.endereco || ''}${telefone}${site}${email}${distanciaTexto}`
);


          // Decide em qual lista (UFU ou Cidade)
          const categoria = (espaco.categoria || "").trim().toLowerCase();
          let container;

          if (categoria === "ufu") {
            const campus = (espaco.campus || "Outro").trim();
            const campusId = "ufu-" + campus.toLowerCase().replace(/\s/g, "-");

          if (!document.getElementById(campusId)) {
            const titulo = document.createElement("div");
            titulo.id = campusId;
            titulo.className = "menu-titulo";
            titulo.innerHTML = `<strong>üìç ${campus}</strong>`;
            document.getElementById("espacos-ufu").appendChild(titulo);
          }

          container = document.getElementById(campusId);
        } else {
          container = document.getElementById("espacos-cidade");
        }

          // Item com √≠cone
          const item = document.createElement("a");
          const iconName = faFor(espaco.tipo);
          item.href = "#";
          item.innerHTML = `<i class="fa-solid fa-${iconName}"></i> ${espaco.nome}`;
          item.onclick = () => {
            map.setView([espaco.latitude, espaco.longitude], 18);
            marker.openPopup();
          };

          container.appendChild(item);
        });
      });

// ===== DROPDOWNS (abre e fecha corretamente) =====
document.querySelectorAll(".dropdown-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const parent = btn.parentElement;
    const isActive = parent.classList.contains("active");

    // Fecha todos os dropdowns
    document.querySelectorAll(".dropdown").forEach(drop => {
      drop.classList.remove("active");
    });

    // Se o clicado estava fechado, abre
    if (!isActive) {
      parent.classList.add("active");
    }
  });
});

    // ===== √çCONES DE MARCADORES (azul UFU / verde Cidade) =====
    const blueIcon = new L.Icon({
      iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const greenIcon = new L.Icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const redIcon = new L.Icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const purpleIcon = new L.Icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    // ===== BOT√ÉO TELA CHEIA =====
    const fsButton = L.control({ position: 'topleft' });
    fsButton.onAdd = function () {
      const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
      div.innerHTML = '<a href="#" title="Tela cheia"><i class="fa-solid fa-expand"></i></a>';
      div.style.backgroundColor = 'white';
      div.style.width = '34px';
      div.style.height = '34px';
      div.style.display = 'flex';
      div.style.alignItems = 'center';
      div.style.justifyContent = 'center';
      div.style.cursor = 'pointer';

      div.onclick = () => {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      };
      return div;
    };
    fsButton.addTo(map);

   // ===== √çCONE DO USU√ÅRIO =====
const userIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

let userMarker = null;

document.getElementById("btn-localizacao").addEventListener("click", () => {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
  function (position) {
    const lat = position.coords.latitude;
    const lng = position.coords.longitude;
    const precisao = position.coords.accuracy;

    if (userMarker) {
      map.removeLayer(userMarker);
    }

    userMarker = L.marker([lat, lng], { icon: userIcon }).addTo(map);
    todosOsMarcadores.forEach(({ marker, espaco }) => {
      const telefone = espaco.telefone ? `<br><b>Tel.:</b> ${espaco.telefone}` : '';
      const site = espaco.site ? `<br><a href="${espaco.site}" target="_blank">Site oficial</a>` : '';
      const email = espaco.email ? `<br><b>Email:</b> <a href="mailto:${espaco.email}">${espaco.email}</a>` : '';

      const userLat = userMarker.getLatLng().lat;
      const userLng = userMarker.getLatLng().lng;
      const dist = calcularDistancia(userLat, userLng, espaco.latitude, espaco.longitude);
      const distanciaTexto = `<br><br><b>Dist√¢ncia aproximada:</b> ${dist.toFixed(2)} km`;

      marker.bindPopup(
        `<b>${espaco.nome}</b><br>${espaco.endereco || ''}${telefone}${site}${email}${distanciaTexto}`
      );
    });

    userMarker.bindPopup(`üìç Voc√™ est√° aqui<br><small>Precis√£o estimada: ${precisao.toFixed(0)} metros</small>`).openPopup();
    map.setView([lat, lng], 16);
  },
  function (error) {
    alert(
      "üìç N√£o foi poss√≠vel acessar sua localiza√ß√£o.\n" +
      "‚Üí Verifique se as permiss√µes de localiza√ß√£o est√£o ativadas para este navegador.\n" +
      "‚Üí Em computadores, libere o acesso nas configura√ß√µes do navegador.\n" +
      "‚Üí Em celulares, ajuste as permiss√µes de localiza√ß√£o nas configura√ß√µes do sistema.\n" +
      "‚Üí Depois disso, recarregue a p√°gina e clique novamente no bot√£o."
    );
  },
  {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
  }
    );
  } else {
    alert("Geolocaliza√ß√£o n√£o suportada neste navegador.");
  }
});

function carregarCidade(tipo) {
  let arquivo = "";
  let containerId = "";

  if (tipo === "P√∫blico") {
    arquivo = "espacos_publicos.json";
    containerId = "espacos-publicos";
  } else if (tipo === "Privado") {
    arquivo = "espacos_privados.json";
    containerId = "espacos-privados";
  } else if (tipo === "Ponto de Cultura") {
    arquivo = "espacos_ponto_cultura.json";
    containerId = "espacos-ponto";
  }

  fetch(arquivo + '?nocache=' + new Date().getTime())
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById(containerId);
      container.innerHTML = ""; // limpa antes de carregar

      data.espacos.forEach(espaco => {
        const iconName = faFor(espaco.tipo);
        let icon = greenIcon;
        if (tipo === "Privado") icon = redIcon;
        if (tipo === "Ponto de Cultura") icon = purpleIcon;

      const marker = L.marker([espaco.latitude, espaco.longitude], { icon }).addTo(map);

        todosOsMarcadores.push({ marker, espaco });

        const telefone = espaco.telefone ? `<br><b>Tel.:</b> ${espaco.telefone}` : '';
        const site = espaco.site ? `<br><a href="${espaco.site}" target="_blank">Site oficial</a>` : '';
        const email = espaco.email ? `<br><b>Email:</b> <a href="mailto:${espaco.email}">${espaco.email}</a>` : '';

        marker.bindPopup(
          `<b>${espaco.nome}</b><br>${espaco.endereco || ''}${telefone}${site}${email}`
        );

        const item = document.createElement("a");
        item.href = "#";
        item.innerHTML = `<i class="fa-solid fa-${iconName}"></i> ${espaco.nome}`;
        item.onclick = () => {
          map.setView([espaco.latitude, espaco.longitude], 18);
          marker.openPopup();
        };

        container.appendChild(item);
      });
    });
}
function mostrarSobre() {
  alert(
    "üìç Este mapa destaca os espa√ßos culturais da Universidade Federal de Uberl√¢ndia (UFU).\n\n" +
    "Explore os campi da UFU e, se desejar, visualize tamb√©m os espa√ßos p√∫blicos, privados e pontos de cultura da cidade."
  );
}
  </script>
</body>
</html>
